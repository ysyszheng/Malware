import os
import pefile

def split_pe_by_sections(pe_file_path, output_folder):
    pe = pefile.PE(pe_file_path)
    os.makedirs(output_folder, exist_ok=True)
    
    output_path = os.path.join(output_folder, "header.bin")
    with open(output_path, 'wb') as output_file:
        output_file.write(pe.header)

    for section in pe.sections:
        section_name = section.Name.rstrip(b'\x00').decode('utf-8')
        section_data = section.get_data()

        output_path = os.path.join(output_folder, f"{section_name}.bin")
        with open(output_path, 'wb') as output_file:
            output_file.write(section_data)

if __name__ == "__main__":
    pe_file_path = r'data/raw/Backdoor/8fff1ffe315dde01a8360e1449bd1031'
    output_folder = r'./data/section'
    split_pe_by_sections(pe_file_path, output_folder)
