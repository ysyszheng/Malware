import os
import numpy as np
import matplotlib.pyplot as plt

file_path = r'./data/test'
img_path = r'./data/test.png'
file_size = os.path.getsize(file_path)

# map file size to image width
file_size_kb = file_size/1024
size_range = [0,10,30,60,100,200,500,1000]
width_arr = [32,64,128,256,384,512,768,1024]
idx = np.searchsorted(size_range, file_size_kb, side='right') - 1
width = width_arr[idx]
print(f'file size: {file_size_kb:.2f} KB, image width: {width} px')

Mat = np.zeros((np.uint(np.ceil(file_size/width)),width),dtype=np.uint8)
cnt = 0
with open(file_path, "rb") as f:
  while (byte := f.read(1)):
    Mat[cnt//width,cnt%width] = int.from_bytes(byte,byteorder='little')
    cnt = cnt + 1

plt.imshow(Mat,cmap='gray',vmin=0,vmax=255)
plt.show()
plt.imsave(img_path,Mat,cmap='gray',vmin=0,vmax=255)
