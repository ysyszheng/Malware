from config.cfgs import cfgs
import argparse
import os

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--model', type = str, default = None, help = 'Model')
    parser.add_argument('--mode', type = str, default = 'train', help = 'Mode')
    args = parser.parse_args()

    if args.model is not None:
        cfgs['model'] = args.model
    if args.mode is not None:
        cfgs['mode'] = args.mode

    for dir in [cfgs['save_model_path'],cfgs['save_data_path'],cfgs['save_img_path']]:
        os.makedirs(dir, exist_ok=True)

    if args.model in ['vgg16', 'resnet50', 'googlenet', 'densenet121', 'shufflenet']:
        if args.mode == 'train':
            from scripts.train import Trainer
            trainer = Trainer(cfgs)
            trainer.training()
        elif args.mode == 'test':
            from scripts.train import Trainer
            trainer = Trainer(cfgs)
            trainer.testing()
        else:
            raise NotImplementedError
    elif args.model == 'majority_voting':
        from scripts.ensemble import Ensembler
        ensembler = Ensembler(cfgs)
        ensembler.majority_voting()
    elif args.model == 'distribution_summation':
        from scripts.ensemble import Ensembler
        ensembler = Ensembler(cfgs)
        ensembler.distribution_summation()
    elif args.model == 'bayesian_combination':
        from scripts.ensemble import Ensembler
        ensembler = Ensembler(cfgs)
        ensembler.bayesian_combination()
    elif args.model == 'stacking':
        from scripts.ensemble import Ensembler
        ensembler = Ensembler(cfgs)
        ensembler.stacking()
    else:
        raise NotImplementedError